import{d as B,N as j,l as c,m as G,p as H,q as $,o as v,b as C,a as s,t as g,v as x,i as z,x as T,h as y,w,g as b,F,f as o,y as k,z as L,A,B as D,C as N,D as O,E as P,c as W,M as S}from"./index-BwM74EYG.js";import{q as U}from"./qrVals-ZHuO51Fl.js";import{g as V,s as Y,a as J}from"./index-2cab5241-FfdGktIA.js";const K={class:"flex items-center justify-center min-h-screen p-4"},Q={key:0,class:"fixed inset-0 top-0 bottom-0 left-0 right-0 z-50 flex items-center justify-center w-full bg-black bg-opacity-50"},X={class:"relative w-full max-w-md p-6 bg-white rounded-lg shadow-lg font-poppins"},Z={class:"absolute text-gray-400 top-4 right-4 hover:text-gray-600 focus:outline-none"},ee={class:"mb-4"},se={class:"relative mt-1 rounded-md shadow-sm"},oe={class:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"},te={class:"flex flex-col w-full max-w-5xl p-8 space-y-4 bg-white rounded-lg shadow-lg md:flex-row md:space-y-0 md:space-x-8"},ie={class:"w-full md:w-1/2"},ne={class:"space-y-4"},ae={class:"flex items-center justify-between mt-2"},re={class:"mt-4 text-center"},le={class:"mt-5 text-sm text-center font-poppins text-slate-800"},de=B({__name:"LoginCard",setup(_){const l=new j({position:{x:"center",y:"top"},dismissible:!0,duration:5e3}),r=c(!1),q=V(),u=G(),m=c(""),f=c(""),I=H(),M=async()=>{var a;o().setIsLoadingLogin(!0);try{const e=await J(q,m.value,f.value),i=e.user;if(console.log(i.emailVerified),!i.emailVerified){l.error("Su correo no ha sido verificado, revise su correo y de click en el enlace de verificación"),o().setIsLoadingLogin(!1);return}if(i&&((a=i.displayName)!=null&&a.includes("administrador"))){o().setIsAdmin(!0),o().setIsUserAuth(!0),o().setUserUid(e.user.uid);const n=k(u,"condominios"),p=L(n,A("createdBy","==",i.uid)),t=await D(p);t.empty||(console.log(t.docs[0].data()),o().setAdimnDocId(t.docs[0].id),o().setCondominiumId(t.docs[0].data().condominiumId),o().setInvitationCode(t.docs[0].data().invitationId),U().setLink(`https://shykandev.github.io/micondominio/register?tipoCuenta=propietario&codigoInvitacion=${t.docs[0].data().invitationId}`),I.push({name:"dashboard"})),o().setIsLoadingLogin(!1)}else if(i&&i.displayName&&i.displayName.includes("propietario")){o().setIsAdmin(!1),o().setUserUid(e.user.uid),N().setOwnerName(i.displayName);const n=k(u,"usersGeneral"),p=L(n,A("userUid","==",i.uid)),t=await D(p);if(t.empty)console.log("No existe ese usuario"),o().setIsLoadingLogin(!1);else{if(console.log(t.docs[0].data()),t.docs[0].data().isBlocked){l.error("No se puede iniciar sesión, usuario bloqueado por el administrador del condominio"),o().setIsLoadingLogin(!1);return}const R=O(u,"condominios",t.docs[0].data().asociatedToCondominiumId),h=await P(R);if(h.exists()&&t.docs[0].data().invitationCode!==h.data().invitationId){l.error("No se puede iniciar sesión, el código asociado a esta cuenta no se encontró en el sistema, por favor contacte al administrador de su condominio"),o().setIsLoadingLogin(!1);return}o().setOwnerInvitationCode(t.docs[0].data().invitationCode),o().setAdimnDocId(t.docs[0].data().asociatedToCondominiumId),N().setUserDataId(t.docs[0].data().userDataId),o().setIsUserAuth(!0),U().setLink(`http://localhost:5173/micondominio/register?tipoCuenta=propietario&codigoInvitacion=${t.docs[0].data().invitationCode}`),o().setIsLoadingLogin(!1),I.push({name:"about"})}}}catch(e){o().setIsLoadingLogin(!1),l.error("Error al iniciar sesión, verifique su contraseña o correo"),console.log("Error al iniciar sesión",e)}},d=c(""),E=async()=>{try{const a=V();a.currentUser&&(await Y(a,d.value),l.success("Se envió un correo para reestablecer su contraseña"),d.value="",r.value=!1)}catch(a){console.log(a)}};return(a,e)=>{const i=$("RouterLink");return v(),C(F,null,[e[17]||(e[17]=s("img",{src:"https://images.unsplash.com/photo-1523789265170-a9376a327aed?q=80&w=1470&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",class:"fixed top-0 bottom-0 left-0 right-0 object-cover w-full h-full animate-fade -z-10",alt:""},null,-1)),s("section",K,[r.value?(v(),C("div",Q,[s("div",X,[s("button",Z,[s("i",{onClick:e[0]||(e[0]=n=>r.value=!1),class:"fas fa-times"})]),e[7]||(e[7]=s("h2",{class:"mb-4 text-2xl font-bold"},"Recuperación de Contraseña",-1)),e[8]||(e[8]=s("p",{class:"mb-4"},"Introduzca su correo electrónico para restablecer la contraseña.",-1)),s("div",ee,[e[6]||(e[6]=s("label",{for:"email",class:"block text-sm font-medium text-gray-700"},"Correo Electrónico",-1)),s("div",se,[s("div",oe,[s("i",{onClick:e[1]||(e[1]=n=>r.value=!1),class:"text-gray-400 fas fa-envelope"})]),g(s("input",{"onUpdate:modelValue":e[2]||(e[2]=n=>d.value=n),type:"email",id:"email",class:"block w-full py-2 pl-10 pr-3 border border-gray-300 rounded-md focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm",placeholder:"correo@ejemplo.com"},null,512),[[x,d.value]])])]),s("button",{onClick:E,class:"w-full py-2 text-white rounded-md bg-sky-600 hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-offset-2"}," Restablecer Contraseña ")])])):z("",!0),s("div",te,[s("div",ie,[e[15]||(e[15]=s("h2",{class:"mb-4 text-2xl text-blue-600 font-poppins"},"Iniciar sesión",-1)),s("form",ne,[s("div",null,[e[9]||(e[9]=s("label",{for:"email",class:"block text-sm font-medium text-gray-700"},"Correo electrónico",-1)),g(s("input",{"onUpdate:modelValue":e[3]||(e[3]=n=>m.value=n),type:"email",id:"email",placeholder:"correo@ejemplo.com",class:"w-full px-4 py-2 mt-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[x,m.value]])]),s("div",null,[e[10]||(e[10]=s("label",{for:"password",class:"block text-sm font-medium text-gray-700"},"Contraseña",-1)),g(s("input",{"onUpdate:modelValue":e[4]||(e[4]=n=>f.value=n),type:"password",id:"password",placeholder:"********",class:"w-full px-4 py-2 mt-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[x,f.value]])]),s("div",ae,[s("a",{onClick:e[5]||(e[5]=n=>r.value=!r.value),class:"text-sm text-blue-500 cursor-pointer"},"¿Olvidó su contraseña?")]),s("button",{type:"submit",onClick:T(M,["prevent"]),class:"w-full py-2 mt-4 font-semibold text-white transition-all bg-blue-600 rounded-md hover:bg-blue-700"},"Iniciar sesión")]),s("div",re,[e[12]||(e[12]=s("p",{class:"text-sm text-gray-600"},"¿No tienes una cuenta?",-1)),y(i,{to:{name:"register"},class:"font-semibold text-blue-600"},{default:w(()=>e[11]||(e[11]=[b("Crear cuenta")])),_:1})]),s("div",null,[s("p",le,[e[14]||(e[14]=b("¿Necesitas Ayuda? ")),y(i,{class:"text-sky-600",to:{name:"help"}},{default:w(()=>e[13]||(e[13]=[b(" Como Usar")])),_:1})])])]),e[16]||(e[16]=s("div",{class:"w-full text-center md:w-1/2 md:text-left"},[s("h3",{class:"mb-4 text-xl text-center text-gray-800 font-poppins"},"Inicie sesión para interactuar con su condominio/edificio"),s("img",{src:"https://images.unsplash.com/photo-1517048676732-d65bc937f952?q=80&w=1470&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",alt:"Imagen",class:"mx-auto rounded-md w-4/4 md:mx-0"})],-1))])])],64)}}}),fe=B({__name:"LoginView",setup(_){return(l,r)=>(v(),W(S,null,{main:w(()=>[y(de)]),_:1}))}});export{fe as default};
