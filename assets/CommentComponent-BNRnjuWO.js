import{d as $,ai as h,o as m,b as p,a as e,n as u,ag as w,i as C,g as y,u as d,C as a,N as S,l as k,m as A,H as R,y as N,f,t as T,v as U,F as j,aj as L,c as I,B as q,J as B,T as E,K as F,D as M,E as V}from"./index-BwM74EYG.js";const O={class:"flex items-center mb-4"},P={class:"font-poppins"},z={class:"text-lg font-semibold"},H={key:0,class:"absolute text-white top-2 right-3 fas fa-user-shield animate-pulse"},J=["innerHTML"],K={class:"flex items-center justify-between min-w-60"},G={class:"text-xs"},Q={class:"flex items-center justify-end mt-4 space-x-4"},W=$({__name:"CommentCard",props:{userName:{type:String,required:!1,default:"Daniel Martinez"},userType:{type:String,required:!1,default:"propietario"},comment:{type:String,required:!1,default:"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua."},date:{type:Object,required:!0},fromAdmin:{type:Boolean,default:!1},isUrgent:{type:Boolean,default:!1}},setup(n){const r=n,g=h(()=>r.userName.includes("administrado")?r.userName.replace(/administrador/gi,"").trim():r.userName.replace(/propietario/gi,"").trim()),x=h(()=>{const i=r.date.toDate();return i.toLocaleDateString()+" "+i.toLocaleTimeString()}),c=h(()=>r.comment.replace(/^(Respuesta a [^:]+:)/,i=>(console.log("Match:",i),`<span class='text-sm italic font-semibold text-sky-800 font-poppins '>${i}</span>`)));return(i,s)=>(m(),p("div",{class:u(["w-full relative max-w-md p-6 rounded-lg shadow-lg hover:border-[1px] hover:border-slate-700",n.userName.includes("administrador")?"bg-sky-900 text-white border-2 border-sky-700":"bg-slate-50"])},[e("div",O,[e("i",{class:u(["mr-3 text-3xl",n.userName.includes("administrador")?"text-white":"text-gray-500","fas fa-user-circle"])},null,2),e("div",P,[e("h2",z,w(g.value),1),n.userName.includes("administrador")?(m(),p("i",H)):C("",!0),e("p",{class:u(["text-sm",n.userName.includes("administrador")?"text-white":"text-gray-500"])},[e("small",null,[s[2]||(s[2]=e("i",{class:"mr-1 fas fa-tag"},null,-1)),y("Categoría: "+w(n.userType),1)])],2),e("p",{class:u(["text-sm",n.userName.includes("administrador")?"text-white":"text-gray-500"])},[e("small",null,[s[3]||(s[3]=e("i",{class:"mr-1 fas fa-user"},null,-1)),y("Usuario: "+w(n.userName.includes("propietario")?"Propietario":"Administrador"),1)])],2)])]),e("p",{class:u(["mb-4 font-poppins",n.userName.includes("administrador")?"text-white":"text-gray-700"]),innerHTML:c.value},null,10,J),e("div",K,[e("div",{class:u(["flex items-center w-full",n.userName.includes("administrador")?"text-white":"text-gray-500"])},[s[4]||(s[4]=e("i",{class:"mr-1 fas fa-calendar-alt"},null,-1)),e("span",G,"Fecha: "+w(x.value),1)],2),e("div",Q,[e("button",{onClick:s[0]||(s[0]=b=>d(a)().setShowPopUpAnswerComment(!0,g.value)),class:"px-1 flex items-center py-[3px] font-signika text-white bg-blue-500 rounded-lg hover:bg-blue-600"},s[5]||(s[5]=[e("i",{class:"mr-1 fas fa-reply"},null,-1),y(" Responder ")])),e("button",{onClick:s[1]||(s[1]=b=>d(a)().setShowReportComment(!0)),class:u(n.userName.includes("administrador")?"text-white hover:text-rose-400":"text-gray-500 hover:text-rose-700")},s[6]||(s[6]=[e("i",{class:"fas fa-flag"},null,-1)]),2)])])],2))}}),X={class:"flex w-full p-4 mx-auto mt-10 overflow-hidden bg-white rounded-lg shadow-lg justify-evenly"},Y={key:0,class:"fixed top-0 bottom-0 left-0 right-0 z-50 flex items-center justify-center w-full bg-black bg-opacity-65 font-poppins animate-fade animate-duration-300"},Z={class:"w-full max-w-md p-6 bg-white rounded-lg shadow-lg animate-fade-up"},_={class:"flex justify-end space-x-4 font-signika"},ee={key:1,class:"fixed left-0 z-40 w-full max-w-md p-6 bg-white border-t-2 border-b-2 border-r-2 rounded-lg shadow-lg bottom-1"},te={class:"flex items-center mb-4"},se={class:"text-lg font-medium font-poppins"},oe={class:"text-blue-500 underline font-poppins"},ne={class:"flex flex-wrap w-full gap-5 justify-evenly"},re=$({__name:"CommentComponent",setup(n){const r=new S({duration:6e3,dismissible:!0,position:{x:"left",y:"top"},ripple:!0}),g=k([]),x=A(),c=k(""),i=async()=>{f().setIsLoadingOwner(!0);const l=N(x,`condominios/${f().getAdminDocId}/comments`);try{(await q(l)).forEach(o=>{g.value.push(o.data())}),f().setIsLoadingOwner(!1)}catch(t){console.log(t),f().setIsLoadingOwner(!1)}};R(()=>{i()});const s=N(x,`condominios/${f().getAdminDocId}/comments`),b=async()=>{const l=M(x,"condominios",f().getAdminDocId,"usuarios",a().getUserDataId),t=await V(l);if(t.exists()){if(!t.data().allowComments)return r.error("Error al agregar el comentario, no tienes permiso para comentar en este dominio"),!1}else return console.log("No such document!"),!1;return!0},D=async()=>{try{if(!await b())return;const t=await B(s,{announcement:`Respuesta a ${a().getAnswerCommentTo}: ${c.value}`,author:a().getOwnerName,category:"Respuesta a comentario",date:E.now()});await F(t,{documentId:t.id}),r.success("Se ha respondido el comentario"),c.value="",a().setClosePopUpAnswerComment()}catch(l){console.log(l)}};return(l,t)=>(m(),p("div",X,[d(a)().getShowReportComment?(m(),p("section",Y,[e("div",Z,[t[4]||(t[4]=e("h2",{class:"mb-4 text-xl font-bold"},"¿Deseas enviar el reporte de este comentario al administrador?",-1)),t[5]||(t[5]=e("p",{class:"mb-4 text-sm"},"Si crees que este comentario infringe los términos y condiciones o contiene lenguaje ofensivo, puedes reportarlo al administrador para su revisión.",-1)),e("div",_,[e("button",{onClick:t[0]||(t[0]=o=>d(a)().setShowReportComment(!1)),class:"px-4 py-2 text-gray-700 bg-gray-300 rounded hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-opacity-50"},"Cancelar"),e("button",{onClick:t[1]||(t[1]=o=>d(a)().setShowReportComment(!1)),class:"px-4 py-2 text-white bg-red-500 rounded hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50"},"Reportar")])])])):C("",!0),d(a)().getShowPopUpAnswerComment?(m(),p("div",ee,[e("i",{onClick:t[2]||(t[2]=o=>d(a)().setClosePopUpAnswerComment()),class:"absolute top-0 text-2xl cursor-pointer right-2 hover:text-sky-300 text-sky-500 fas fa-times",title:"cerrar"}),e("div",te,[t[7]||(t[7]=e("i",{class:"mr-3 text-3xl text-sky-800 fas fa-comment"},null,-1)),e("div",null,[e("h2",se,[t[6]||(t[6]=y(" Responder a ")),e("span",oe,w(d(a)().getAnswerCommentTo),1)])])]),T(e("textarea",{class:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","onUpdate:modelValue":t[3]||(t[3]=o=>c.value=o),placeholder:"Escribe tu respuesta aquí...",rows:"4"},null,512),[[U,c.value]]),e("button",{onClick:D,class:"w-full py-2 mt-4 text-white bg-blue-500 rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 font-signika"},t[8]||(t[8]=[e("i",{class:"mr-2 fas fa-paper-plane"},null,-1),y(" Enviar ")]))])):C("",!0),e("section",ne,[(m(!0),p(j,null,L(g.value.sort((o,v)=>v.date-o.date),(o,v)=>(m(),I(W,{key:v,comment:o.announcement,date:o.date,"from-admin":o.fromAdmin,"is-urgent":l.isUrgent,"user-name":o.author,"user-type":o.category},null,8,["comment","date","from-admin","is-urgent","user-name","user-type"]))),128))])]))}});export{re as default};
