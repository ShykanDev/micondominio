import{d as D,a1 as N,o as c,e as y,a as e,g as r,a0 as f,m as g,h as a,a2 as L,q as x,v as w,t as k,j as B,F as C,a3 as O,c as U}from"./index-TFeQVYrp.js";import{N as _}from"./notyf.min-ll9y_k96.js";import{g as V,c as $,a as T,b as A,T as E,u as F,d as Q,e as M}from"./index.esm2017-DkIOf4jH.js";import{o as h}from"./ownerVals-Brrn9QFR.js";const R={class:"w-full max-w-sm p-2 px-5 shadow-lg bg-slate-50 rounded-2xl"},z={class:"flex items-center justify-between mb-3"},G={class:"flex items-center text-2xl font-semibold text-rose-800"},H={class:"mb-3"},J={class:"flex items-center text-xl font-medium text-gray-700"},K={class:"mb-3"},P={class:"flex items-center text-gray-600"},W={class:"mb-3"},X={class:"flex items-center text-gray-600"},Y=D({__name:"ComplaintCard",props:{complaint:{type:String,required:!0},complaintCategory:{type:String,required:!0},date:{type:String,required:!0},documentId:{type:String,required:!0},resolved:{type:Boolean,required:!0},resolvedBy:{type:String,required:!0},resolvedDate:{type:String,required:!0},userUid:{type:String,required:!0},userName:{type:String,required:!0}},setup(u){const n=u,l=N(()=>{if(typeof n.date=="object"&&n.date.toDate){const i=n.date.toDate();return i.toLocaleDateString()+" "+i.toLocaleTimeString()}return n.date});return(i,s)=>(c(),y("div",R,[e("div",z,[e("h2",G,[s[0]||(s[0]=e("i",{class:"mr-2 fas fa-exclamation-triangle"},null,-1)),r(" "+f(u.complaintCategory),1)])]),e("div",H,[e("h3",J,[s[1]||(s[1]=e("i",{class:"mr-2 fas fa-user-circle"},null,-1)),s[2]||(s[2]=r(" Nombre del usuario que reporta: ")),e("span",null,f(u.userName),1)])]),e("div",K,[e("p",P,[s[3]||(s[3]=e("i",{class:"mr-2 fas fa-align-justify"},null,-1)),r(f(u.complaint),1)])]),e("div",W,[e("p",X,[s[4]||(s[4]=e("i",{class:"mr-2 fas fa-calendar-day"},null,-1)),r(" Fecha de la Queja: "+f(l.value),1)])]),s[5]||(s[5]=e("div",{class:"flex justify-end"},null,-1))]))}}),Z={key:0,class:"fixed w-full max-w-md p-6 bg-white border-2 rounded-lg shadow-lg font-poppins bottom-2 left-2 border-rose-800"},ee={class:"mb-4"},te={class:"mb-4"},se={class:"flex justify-end"},oe={class:"flex flex-wrap p-4 space-y-4 bg-white rounded-lg shadow-lg justify-evenly"},ie=D({__name:"ComplaintsComponent",setup(u){const n=new _({duration:6e3,dismissible:!0,position:{x:"left",y:"top"},ripple:!0}),l=g(!1),i=g([]),s=()=>{l.value=!l.value},m=g(""),p=g(""),b=V(),v=$(b,`condominios/${a().getAdminDocId}/complaints`),j=async()=>{a().setIsLoadingOwner(!0);try{(await T(v)).forEach(t=>{i.value.push(t.data())}),a().setIsLoadingOwner(!1)}catch(d){a().setIsLoadingOwner(!1),console.log(d)}},q=async()=>{const d=Q(b,"condominios",a().getAdminDocId,"usuarios",h().getUserDataId),t=await M(d);if(t.exists()){if(!t.data().allowComments)return n.error("Error al agregar el comentario, no tienes permiso para comentar en este dominio"),!1}else return console.log("No such document!"),!1;return!0},I=async()=>{if(a().setIsLoadingOwner(!0),!await q()){a().setIsLoadingOwner(!1);return}try{const t=await A(v,{date:E.now(),complaint:m.value,complaintCategory:p.value,resolved:!1,resolvedDate:"",resolvedBy:"",documentId:"",userName:h().getOwnerName,userUid:a().getUserUid});await F(t,{documentId:t.id}),a().setIsLoadingOwner(!1),n.success("Se ha agregado la queja"),l.value=!1,m.value="",p.value=""}catch(t){a().setIsLoadingOwner(!1),console.log(t)}};return L(()=>{j()}),(d,t)=>(c(),y(C,null,[l.value?(c(),y("div",Z,[t[6]||(t[6]=e("h2",{class:"mb-4 text-2xl font-bold text-gray-800"},"Levantar una Queja",-1)),e("button",{onClick:s,class:"absolute px-4 py-2 text-white rounded-lg bg-slate-500 top-1 right-1 hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500"},t[2]||(t[2]=[e("i",{class:"mr-2 fas fa-times"},null,-1),r(" Cerrar ")])),e("form",null,[e("div",ee,[t[3]||(t[3]=e("label",{for:"tipo-queja",class:"block mb-2 font-bold text-gray-700"},[e("i",{class:"fas fa-exclamation-circle"}),r(" Tipo de Queja ")],-1)),x(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>p.value=o),type:"text",id:"tipo-queja",class:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el tipo de queja e.g. Corte de luz"},null,512),[[w,p.value]])]),e("div",te,[t[4]||(t[4]=e("label",{for:"resumen",class:"block mb-2 font-bold text-gray-700"},[e("i",{class:"fas fa-align-left"}),r(" Resumen ")],-1)),x(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=o=>m.value=o),id:"resumen",rows:"4",class:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Describa su queja"},null,512),[[w,m.value]])]),e("div",se,[e("button",{onClick:k(I,["prevent"]),type:"submit",class:"px-4 py-2 text-white bg-blue-500 rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500"},t[5]||(t[5]=[e("i",{class:"fas fa-paper-plane"},null,-1),r(" Enviar ")]))])])])):B("",!0),e("button",{onClick:s,class:"fixed px-4 py-2 text-white border-2 rounded-lg border-slate-600 bg-rose-500 font-poppins bottom-2 right-2 hover:bg-rose-600 focus:outline-none focus:ring-2 focus:ring-rose-500"},t[7]||(t[7]=[e("i",{class:"mr-2 fas fa-plus"},null,-1),r(" Nueva Queja ")])),e("div",oe,[(c(!0),y(C,null,O(i.value,(o,S)=>(c(),U(Y,{key:S,complaint:o.complaint,"complaint-category":o.complaintCategory,date:o.date,"document-id":o.documentId,resolved:o.resolved,"resolved-by":o.resolvedBy,"resolved-date":o.resolvedDate,"user-name":o.userName,"user-uid":o.userUid},null,8,["complaint","complaint-category","date","document-id","resolved","resolved-by","resolved-date","user-name","user-uid"]))),128))])],64))}});export{ie as default};
