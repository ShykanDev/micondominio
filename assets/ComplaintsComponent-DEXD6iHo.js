import{d as j,ai as N,o as c,b as y,a as e,g as l,ag as f,N as L,l as g,m as k,y as B,f as a,H as O,t as w,v as C,x as U,i as _,F as h,aj as V,c as $,B as T,J as A,T as E,C as D,K as F,D as Q,E as M}from"./index-BwM74EYG.js";const R={class:"w-full max-w-sm p-2 px-5 shadow-lg bg-slate-50 rounded-2xl"},z={class:"flex items-center justify-between mb-3"},H={class:"flex items-center text-2xl font-semibold text-rose-800"},J={class:"mb-3"},K={class:"flex items-center text-xl font-medium text-gray-700"},G={class:"mb-3"},P={class:"flex items-center text-gray-600"},W={class:"mb-3"},X={class:"flex items-center text-gray-600"},Y=j({__name:"ComplaintCard",props:{complaint:{type:String,required:!0},complaintCategory:{type:String,required:!0},date:{type:String,required:!0},documentId:{type:String,required:!0},resolved:{type:Boolean,required:!0},resolvedBy:{type:String,required:!0},resolvedDate:{type:String,required:!0},userUid:{type:String,required:!0},userName:{type:String,required:!0}},setup(u){const n=u,r=N(()=>{if(typeof n.date=="object"&&n.date.toDate){const i=n.date.toDate();return i.toLocaleDateString()+" "+i.toLocaleTimeString()}return n.date});return(i,s)=>(c(),y("div",R,[e("div",z,[e("h2",H,[s[0]||(s[0]=e("i",{class:"mr-2 fas fa-exclamation-triangle"},null,-1)),l(" "+f(u.complaintCategory),1)])]),e("div",J,[e("h3",K,[s[1]||(s[1]=e("i",{class:"mr-2 fas fa-user-circle"},null,-1)),s[2]||(s[2]=l(" Nombre del usuario que reporta: ")),e("span",null,f(u.userName),1)])]),e("div",G,[e("p",P,[s[3]||(s[3]=e("i",{class:"mr-2 fas fa-align-justify"},null,-1)),l(f(u.complaint),1)])]),e("div",W,[e("p",X,[s[4]||(s[4]=e("i",{class:"mr-2 fas fa-calendar-day"},null,-1)),l(" Fecha de la Queja: "+f(r.value),1)])]),s[5]||(s[5]=e("div",{class:"flex justify-end"},null,-1))]))}}),Z={key:0,class:"fixed w-full max-w-md p-6 bg-white border-2 rounded-lg shadow-lg font-poppins bottom-2 left-2 border-rose-800"},ee={class:"mb-4"},te={class:"mb-4"},se={class:"flex justify-end"},oe={class:"flex flex-wrap p-4 space-y-4 bg-white rounded-lg shadow-lg justify-evenly"},le=j({__name:"ComplaintsComponent",setup(u){const n=new L({duration:6e3,dismissible:!0,position:{x:"left",y:"top"},ripple:!0}),r=g(!1),i=g([]),s=()=>{r.value=!r.value},m=g(""),p=g(""),v=k(),x=B(v,`condominios/${a().getAdminDocId}/complaints`),q=async()=>{a().setIsLoadingOwner(!0);try{(await T(x)).forEach(t=>{i.value.push(t.data())}),a().setIsLoadingOwner(!1)}catch(d){a().setIsLoadingOwner(!1),console.log(d)}},I=async()=>{const d=Q(v,"condominios",a().getAdminDocId,"usuarios",D().getUserDataId),t=await M(d);if(t.exists()){if(!t.data().allowComments)return n.error("Error al agregar el comentario, no tienes permiso para comentar en este dominio"),!1}else return console.log("No such document!"),!1;return!0},S=async()=>{if(a().setIsLoadingOwner(!0),!await I()){a().setIsLoadingOwner(!1);return}try{const t=await A(x,{date:E.now(),complaint:m.value,complaintCategory:p.value,resolved:!1,resolvedDate:"",resolvedBy:"",documentId:"",userName:D().getOwnerName,userUid:a().getUserUid});await F(t,{documentId:t.id}),a().setIsLoadingOwner(!1),n.success("Se ha agregado la queja"),r.value=!1,m.value="",p.value=""}catch(t){a().setIsLoadingOwner(!1),console.log(t)}};return O(()=>{q()}),(d,t)=>(c(),y(h,null,[r.value?(c(),y("div",Z,[t[6]||(t[6]=e("h2",{class:"mb-4 text-2xl font-bold text-gray-800"},"Levantar una Queja",-1)),e("button",{onClick:s,class:"absolute px-4 py-2 text-white rounded-lg bg-slate-500 top-1 right-1 hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500"},t[2]||(t[2]=[e("i",{class:"mr-2 fas fa-times"},null,-1),l(" Cerrar ")])),e("form",null,[e("div",ee,[t[3]||(t[3]=e("label",{for:"tipo-queja",class:"block mb-2 font-bold text-gray-700"},[e("i",{class:"fas fa-exclamation-circle"}),l(" Tipo de Queja ")],-1)),w(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>p.value=o),type:"text",id:"tipo-queja",class:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el tipo de queja e.g. Corte de luz"},null,512),[[C,p.value]])]),e("div",te,[t[4]||(t[4]=e("label",{for:"resumen",class:"block mb-2 font-bold text-gray-700"},[e("i",{class:"fas fa-align-left"}),l(" Resumen ")],-1)),w(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=o=>m.value=o),id:"resumen",rows:"4",class:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Describa su queja"},null,512),[[C,m.value]])]),e("div",se,[e("button",{onClick:U(S,["prevent"]),type:"submit",class:"px-4 py-2 text-white bg-blue-500 rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500"},t[5]||(t[5]=[e("i",{class:"fas fa-paper-plane"},null,-1),l(" Enviar ")]))])])])):_("",!0),e("button",{onClick:s,class:"fixed px-4 py-2 text-white border-2 rounded-lg border-slate-600 bg-rose-500 font-poppins bottom-2 right-2 hover:bg-rose-600 focus:outline-none focus:ring-2 focus:ring-rose-500"},t[7]||(t[7]=[e("i",{class:"mr-2 fas fa-plus"},null,-1),l(" Nueva Queja ")])),e("div",oe,[(c(!0),y(h,null,V(i.value.sort((o,b)=>b.date-o.date),(o,b)=>(c(),$(Y,{key:b,complaint:o.complaint,"complaint-category":o.complaintCategory,date:o.date,"document-id":o.documentId,resolved:o.resolved,"resolved-by":o.resolvedBy,"resolved-date":o.resolvedDate,"user-name":o.userName,"user-uid":o.userUid},null,8,["complaint","complaint-category","date","document-id","resolved","resolved-by","resolved-date","user-name","user-uid"]))),128))])],64))}});export{le as default};
